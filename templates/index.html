{% extends "base.html" %}

{% block content %}
<div class="flex flex-col items-center mb-8 pt-4">
    <!-- Profile Image with Neon Glow -->
    <div class="relative w-24 h-24 mb-4 group">
        <div
            class="absolute inset-0 bg-gradient-to-r from-cyber-gold to-cyber-red rounded-full blur opacity-75 group-hover:opacity-100 transition duration-1000 group-hover:duration-200 animate-tilt">
        </div>
        <div
            class="relative w-24 h-24 rounded-full bg-cyber-black border-2 border-cyber-gold flex items-center justify-center overflow-hidden">
            {% if user.photo_url %}
            <img src="{{ user.photo_url }}" alt="Profile" class="w-full h-full object-cover">
            {% else %}
            <i class="fas fa-user-astronaut text-4xl text-gray-400"></i>
            {% endif %}
        </div>
        <!-- Level Badge -->
        <div
            class="absolute -bottom-2 -right-2 bg-cyber-red text-white text-xs font-bold px-2 py-1 rounded border border-white/20 shadow-lg">
            LVL {{ (user.xp / 1000) | int + 1 }}
        </div>
    </div>

    <a href="{{ url_for('profile.view_profile') }}"
        class="text-3xl font-bold text-white tracking-widest uppercase glitch-text hover:text-cyber-gold transition-colors"
        data-text="{{ user.username }}">
        {{ user.username }}
    </a>
    <p class="text-cyber-gold text-sm tracking-widest uppercase mt-1">Cyber Runner</p>

    <!-- Stats Grid -->
    <div class="grid grid-cols-2 gap-4 mt-8 w-full max-w-sm">
        <div
            class="bg-cyber-dark/50 border border-cyber-gold/30 p-4 rounded-xl backdrop-blur-sm relative overflow-hidden group hover:border-cyber-gold transition-colors duration-300">
            <div class="absolute top-0 right-0 p-2 opacity-20 group-hover:opacity-40 transition-opacity">
                <i class="fas fa-coins text-4xl text-cyber-gold"></i>
            </div>
            <p class="text-gray-400 text-xs uppercase tracking-widest mb-1">Credits</p>
            <p class="text-2xl font-bold text-cyber-gold">{{ user.points }}</p>
        </div>

        <div
            class="bg-cyber-dark/50 border border-cyber-red/30 p-4 rounded-xl backdrop-blur-sm relative overflow-hidden group hover:border-cyber-red transition-colors duration-300">
            <div class="absolute top-0 right-0 p-2 opacity-20 group-hover:opacity-40 transition-opacity">
                <i class="fas fa-bolt text-4xl text-cyber-red"></i>
            </div>
            <p class="text-gray-400 text-xs uppercase tracking-widest mb-1">Experience</p>
            <p class="text-2xl font-bold text-cyber-red">{{ user.xp }} XP</p>
        </div>
    </div>
</div>

<!-- Active Mission Panel -->
<div class="mb-24">
    <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-bold text-white uppercase tracking-wider border-l-4 border-cyber-gold pl-3">Current
            Mission</h2>
    </div>

    <div
        class="bg-gradient-to-br from-cyber-dark to-cyber-black border border-white/10 rounded-xl p-6 relative overflow-hidden shadow-lg">
        <!-- Decorative elements -->
        <div class="absolute top-0 right-0 w-20 h-20 bg-cyber-gold/5 rounded-full blur-2xl -mr-10 -mt-10"></div>
        <div class="absolute bottom-0 left-0 w-20 h-20 bg-cyber-red/5 rounded-full blur-2xl -ml-10 -mb-10"></div>

        <div class="relative z-10 text-center">
            <i class="fas fa-satellite-dish text-4xl text-gray-600 mb-4 animate-pulse-slow"></i>
            <p class="text-gray-400 mb-6 font-light">No active missions tracked. Check the Quest Log for available
                contracts.</p>

            <button id="openQuestBtn" data-url="{{ url_for('quests.list_quests') }}"
                class="inline-flex items-center justify-center w-full bg-cyber-gold/10 hover:bg-cyber-gold/20 border border-cyber-gold text-cyber-gold font-bold py-3 px-6 rounded-lg transition-all duration-300 uppercase tracking-wider group">
                <span>Open Quest Log</span>
                <i class="fas fa-arrow-right ml-2 transform group-hover:translate-x-1 transition-transform"></i>
            </button>
        </div>
    </div>
</div>

<!-- Epic Cyberpunk Loader -->
<div id="epicLoader" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/80">
    <div class="relative w-full h-full flex items-center justify-center">
        <div class="absolute inset-0 overflow-hidden">
            <div class="absolute -left-20 -top-20 w-96 h-96 bg-gradient-to-br from-cyber-gold/20 to-cyber-red/10 rounded-full blur-3xl animate-rotate-slow"></div>
            <div class="absolute right-0 top-10 w-72 h-72 bg-gradient-to-br from-cyber-red/10 to-cyber-gold/10 rounded-full blur-2xl"></div>
            <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_center,_var(--tw-gradient-stops))] from-white/2 to-transparent mix-blend-overlay"></div>
        </div>

        <div class="relative z-10 max-w-2xl w-full px-6">
            <div class="bg-[#0f0f10]/80 border border-white/5 rounded-2xl p-8 text-center glass-panel">
                <div class="mb-6">
                    <div class="inline-flex items-center justify-center w-20 h-20 rounded-full bg-gradient-to-br from-cyber-gold to-cyber-red shadow-neon-gold mb-4">
                        <i class="fas fa-satellite-dish text-3xl text-cyber-black animate-pulse"></i>
                    </div>
                    <h2 class="text-3xl font-bold text-white uppercase tracking-wider">Initializing Quest Log</h2>
                    <p class="text-gray-400 mt-2">Syncing live contracts and preparing your cyberdeck...</p>
                </div>

                <div class="relative w-full h-4 bg-white/5 rounded-full overflow-hidden mt-6 mb-4">
                    <div id="epicBar" class="absolute left-0 top-0 h-4 bg-gradient-to-r from-cyber-gold to-cyber-red rounded-full transition-all"
                        style="width:0%"></div>
                </div>

                <p id="epicText" class="text-sm text-gray-300 uppercase tracking-wider">Boot sequence 0%</p>
            </div>
        </div>
    </div>
    <style>
        @keyframes rotate-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-rotate-slow { animation: rotate-slow 12s linear infinite; }
    </style>

    <script>
        (function () {
            const btn = document.getElementById('openQuestBtn');
            const loader = document.getElementById('epicLoader');
            const bar = document.getElementById('epicBar');
            const text = document.getElementById('epicText');

            if (!btn || !loader) return;

            btn.addEventListener('click', function (e) {
                e.preventDefault();
                const url = btn.dataset.url || '/quests/';
                showEpicLoader(url);
            });

            function showEpicLoader(url) {
                loader.classList.remove('hidden');
                // animate progress from 0 to 100 over 10s
                const duration = 10000; // ms
                const fps = 60;
                const totalFrames = Math.round((duration / 1000) * fps);
                let frame = 0;

                const start = Date.now();

                const raf = setInterval(() => {
                    frame++;
                    const elapsed = Date.now() - start;
                    const pct = Math.min(100, Math.round((elapsed / duration) * 100));
                    if (bar) bar.style.width = pct + '%';
                    if (text) text.textContent = `Boot sequence ${pct}%`;

                    if (elapsed >= duration) {
                        clearInterval(raf);
                        // small flourish before redirect
                        setTimeout(() => { window.location.href = url; }, 300);
                    }
                }, 1000 / fps);
            }
        })();
    </script>
</div>
{% endblock %}